<!DOCTYPE html>
<html>
<head>
    <title>CV Upload Metrics</title>
    <script src="https://code.highcharts.com/highcharts.js"></script>
</head>
<body>
    <h2>CV Upload Metrics</h2>

    <div id="uploadChart" style="width:80%; height:400px;"></div>

    <script>
        async function fetchMetrics() {
            const res = await fetch('/metrics');
            const text = await res.text();

            const metrics = {};
            text.split('\n').forEach(line => {
                if (line.startsWith('#') || line.trim() === '') return;
                const [key, value] = line.split(' ');
                metrics[key] = parseFloat(value);
            });

            const success = metrics['upload_cv_success_total'] || 0;
            const failure = metrics['upload_cv_failure_total'] || 0;
            const total = metrics['upload_cv_requests_total'] || 0;
            const avgTime = metrics['upload_cv_processing_seconds_sum'] / metrics['upload_cv_processing_seconds_count'];

            renderChart(success, failure, avgTime);
        }

        function renderChart(success, failure, avgTime) {
            Highcharts.chart('uploadChart', {
                chart: {
                    type: 'column'
                },
                title: {
                    text: 'CV Upload Success vs Failure'
                },
                xAxis: {
                    categories: ['Success', 'Failure', 'Average Time (s)']
                },
                yAxis: {
                    min: 0,
                    title: {
                        text: 'Count / Time'
                    }
                },
                series: [{
                    name: 'CV Uploads',
                    data: [success, failure, avgTime || 0]
                }]
            });
        }

        fetchMetrics();
    </script>
</body>
</html>
